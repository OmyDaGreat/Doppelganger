= Doppelganger - SVG DSL for Kotlin
:toc: left
:toclevels: 3
:source-highlighter: highlightjs
:icons: font

A comprehensive and type-safe DSL for creating and rendering SVG graphics in Compose Multiplatform applications and Kobweb sites.

== Overview

Doppelganger is an SVG wrapper library that provides a Kotlin DSL for creating SVG graphics in Compose Multiplatform applications. Write SVG markup using type-safe Kotlin code and render it seamlessly across all supported platforms.

== Features

* ðŸŽ¨ **Type-safe DSL** - Kotlin-first API for building SVG elements
* ðŸŒ **Multiplatform** - Works on JVM, Android, iOS, JS, and WebAssembly
* ðŸ§© **Composable** - Integrates seamlessly with Compose UI
* ðŸŒ **Kobweb Support** - First-class support for Kobweb web applications (JS-only)
* ðŸ“ **Comprehensive** - Supports all major SVG elements and attributes
* ðŸŽ­ **Gradients & Effects** - Built-in support for gradients, clipping, and masking
* ðŸ”§ **Path DSL** - Intuitive API for creating complex paths

== Quick Start

=== Installation

Add Doppelganger to your Compose Multiplatform project:

[source,kotlin]
----
dependencies {
    implementation("xyz.malefic:doppelganger:$version")
}
----

=== Basic Usage

Create an SVG circle in your Composable:

[source,kotlin]
----
@Composable
fun MyCircle() {
    SvgImage(modifier = Modifier.size(100.dp)) {
        width(100)
        height(100)
        viewBox(0, 0, 100, 100)
        
        circle {
            cx(50)
            cy(50)
            r(40)
            fill("steelblue")
            stroke("navy")
            strokeWidth(2)
        }
    }
}
----

=== Kobweb Usage

Doppelganger includes special support for https://github.com/varabyte/kobweb[Kobweb] applications. See link:KOBWEB_USAGE.md[Kobweb Usage Guide] for detailed documentation.

[source,kotlin]
----
@Composable
fun MyKobwebSvg() {
    SvgImage(
        modifier = Modifier.size(200.px)
    ) {
        width(200)
        height(200)
        circle {
            cx(100)
            cy(100)
            r(80)
            fill("steelblue")
        }
    }
}
----

=== Supported Elements

* **Basic Shapes**: rect, circle, ellipse, line, polyline, polygon
* **Path**: Complete path DSL with moveTo, lineTo, curveTo, arcTo, etc.
* **Text**: text and tspan elements with full styling
* **Containers**: g (group), defs, symbol, use
* **Gradients**: linearGradient, radialGradient with stops
* **Effects**: clipPath, mask

== Building from Source

To build the library:

[source,bash]
----
./gradlew assemble
----

To run tests:

[source,bash]
----
./gradlew allTests
----

To generate documentation:

[source,bash]
----
./gradlew dokkaGenerate
----

== Publishing to Maven Central

This template uses a similar packaging secret method as other Malefic projects, making it easy to set up automated publishing.

[IMPORTANT]
====
For publishing to work, the following GitHub secrets must be configured in your repository:

* `GPG_KEY_ID`: The ID of your GPG key
* `GPG_PASSPHRASE`: The passphrase for your GPG key  
* `GPG_PRIVATE_KEY`: Your GPG private key
* `SONATYPE_TOKEN_XML`: Your Sonatype Central Portal user token in XML format
====

=== Setting Up Secrets

==== GPG Key Setup
1. Generate a GPG key pair:
[source,bash]
----
gpg --full-generate-key
----

2. Export your private key:
[source,bash]
----
gpg --armor --export-secret-keys YOUR_KEY_ID > private_key.gpg
----

3. Get your key ID:
[source,bash]
----
gpg --list-secret-keys --keyid-format=long
----

4. Upload your public key to a keyserver:
[source,bash]
----
gpg --keyserver keyserver.ubuntu.com --send-keys YOUR_KEY_ID
----

==== Sonatype Setup
1. Create an account on https://central.sonatype.com/
2. Register your namespace (e.g., `io.github.yourusername`)
3. Generate a user token from the Account page
4. Copy the XML token block for the GitHub secret

=== Publishing Process

The template includes a GitHub Actions workflow that automatically publishes releases:

1. Create a new release on GitHub
2. The workflow will automatically build and publish to Maven Central
3. Artifacts will be available after Sonatype review (usually 15-30 minutes)

To publish manually:

[source,bash]
----
./gradlew publishToMavenCentral
----

== Project Structure

[source]
----
MultiLibTemplate/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ gradle.yml         # Testing workflow
â”‚       â”œâ”€â”€ deploy-docs.yml    # Dokka workflow
â”‚       â””â”€â”€ publish.yml        # Publishing workflow
â”œâ”€â”€ library/                   # Main library module
â”‚   â”œâ”€â”€ build.gradle.kts      # Library-specific build configuration
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ commonMain/        # Common multiplatform code
â”‚       â”œâ”€â”€ commonTest/        # Common tests
â”‚       â”œâ”€â”€ jvmMain/          # JVM-specific code
â”‚       â”œâ”€â”€ jvmTest/          # JVM-specific tests
â”‚       â”œâ”€â”€ androidMain/      # Android-specific code
â”‚       â”œâ”€â”€ androidTest/      # Android-specific tests
â”‚       â”œâ”€â”€ iosMain/          # iOS-specific code
â”‚       â”œâ”€â”€ iosTest/          # iOS-specific tests
â”‚       â”œâ”€â”€ macosMain/        # macOS-specific code
â”‚       â”œâ”€â”€ macosTest/        # macOS-specific tests
â”‚       â”œâ”€â”€ jsMain/           # JavaScript-specific code
â”‚       â”œâ”€â”€ jsTest/           # JavaScript-specific tests
â”‚       â”œâ”€â”€ wasmMain/         # WebAssembly-specific code
â”‚       â”œâ”€â”€ wasmTest/         # WebAssembly-specific tests
â”‚       â”œâ”€â”€ linuxMain/        # Linux-specific code
â”‚       â””â”€â”€ linuxTest/        # Linux-specific tests
â”œâ”€â”€ build.gradle.kts          # Root build configuration
â”œâ”€â”€ gradle.properties         # Project configuration
â”œâ”€â”€ settings.gradle.kts       # Gradle settings
â””â”€â”€ README.adoc              # This file
----

== Configuration

All project configuration is centralized in `gradle.properties`:

[source,properties]
----
# Developer Information
user=YourGitHubUsername
dev=Your Full Name
mail=your.email@example.com
devURL=https://your-website.com

# Project Information  
repo=YourRepositoryName
g=your.group.id
artifact=your-artifact-name
desc=Your library description
inception=2025

# Version
v=1.0.0
----

== Example Usage

The template includes a simple Fibonacci sequence generator as an example. Replace this with your own library code:

[source,kotlin]
----
// Common code
fun generateFibi() =
    sequence {
        var a = firstElement
        yield(a)
        var b = secondElement
        yield(b)
        while (true) {
            val c = a + b
            yield(c)
            a = b
            b = c
        }
    }

expect val firstElement: Int
expect val secondElement: Int

// Platform-specific implementations
actual val firstElement = 3
actual val secondElement = 4
----

== License

This template is licensed under the MIT License. Update the LICENSE file with your chosen license.

== Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Submit a pull request

== Resources

* https://kotlinlang.org/docs/multiplatform.html[Kotlin Multiplatform Documentation]
* https://central.sonatype.org/[Maven Central Portal]
* https://vanniktech.github.io/gradle-maven-publish-plugin/[Vanniktech Maven Publish Plugin]
* https://github.com/touchlab/Kermit[Kermit Logging Library]
